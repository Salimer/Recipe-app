<h1><%= @recipe.name %> Recipe</h1>
<section class="recipe-details">
  <div class="d-flex gap">
    <p>Preparation time: <%= @recipe.preparation_time_minutes %> mins </p>
    <%= form_for @recipe, url: public_toggle_recipe_path(@recipe), method: :patch, remote: true, authenticity_token: true, html: { class: 'toggle-form' } do |f| %>
        <div class="slider-container">
        <span class="switch-label">Public</span>
        <label class="switch">
          <%= f.check_box :is_public, { class: "toggle-switch" }, 0, 1 %>
          <span class="slider round"></span>
        </label>
      </div>
      <%= f.hidden_field :is_public, value: @recipe.is_public ? 0 : 1 %>
      <%= f.submit 'Toggle', class: 'hidden-submit', style: 'display: none;' %>
    <% end %>
  </div>
  <p>Cooking time: <%= @recipe.cooking_time_minutes %> mins </p>
  <p>Description: <%= @recipe.description %></p>
  <div class="d-flex gap bottom-line p-1">
  <%= link_to  "Generate shopping list", general_shopping_list_recipe_path(@recipe), method: :post %>
  <%= link_to "Add ingredient", new_recipe_recipe_food_path(@recipe), method: :get, class: "btn btn-primary" %>
</section>
 <%if @foods == []%>
      <h2>you have no food ingredients yet, click on "Add ingredient" to add to the list</h2>
    <%else%>
<table class="table">
  <thead>
    <tr>
      <th>Food</th>
      <th>Quantity</th>
      <th>Value</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @recipe_foods.each do |recipe_food| %>
      <tr>
        <td><%= recipe_food.food.name %></td>
        <td><%= recipe_food.quantity %></td>
        <td><%= recipe_food.food.price %></td>
        <td>
          <%= link_to 'Delete', recipe_food_path(recipe_food), data: { turbo_method: :delete, confirm: 'Are you sure?' } %>
          <button class="modify-button">Modify</button>
          <div class="modify-form" style="display: none;">
            <%= form_for recipe_food, url: modify_recipe_food_path(recipe_food), method: :patch, remote: true, authenticity_token: true do |f| %>
              <%= f.label :quantity %>
              <%= f.text_field :quantity, value: recipe_food.quantity %>
              <%= f.submit 'Update', class: 'modify-submit' %>
            <% end %>
          </div>
        </td>
      </tr>
    <% end %>
  </tbody>
    <%end%>
</table>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleSwitch = document.querySelector('.toggle-switch');
    const toggleForm = document.querySelector('.toggle-form');

    if (toggleSwitch && toggleForm) {
      toggleSwitch.addEventListener('change', function () {
        toggleForm.submit();
      });
    }

    const modifyButtons = document.querySelectorAll('.modify-button');
    const modifyForms = document.querySelectorAll('.modify-form');

    modifyButtons.forEach((button, index) => {
      button.addEventListener('click', function () {
        if (modifyForms[index].style.display === 'none') {
          modifyForms[index].style.display = 'block';
        } else {
          modifyForms[index].style.display = 'none';
        }
      });
    });
  });
</script>
