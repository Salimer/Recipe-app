<h3>Recipe no.<%= @recipe.id %> full description</h3>
<h3><%= @recipe.name %></h3>

<section class="recipe-details">
  <div class="d-flex gap">
    <div class="right">
      <p class="input">Preparation time: <%= @recipe.preparation_time_minutes %> mins </p>
      <p  class="input">Cooking time: <%= @recipe.cooking_time_minutes %> mins </p>
    </div>
    <%= form_for @recipe, url: public_toggle_recipe_path(@recipe), method: :patch, remote: true, authenticity_token: true, html: { class: 'toggle-form' } do |f| %>
        <div class="slider-container">
        <span class="switch-label">Public</span>
        <label class="switch">
          <%= f.check_box :is_public, { class: "toggle-switch" }, 0, 1 %>
          <span class="slider round"></span>
        </label>
      </div>
      <%= f.hidden_field :is_public, value: @recipe.is_public ? 0 : 1 %>
      <%= f.submit 'Toggle', class: 'hidden-submit', style: 'display: none;' %>
    <% end %>
  </div>
  <p  class="input"><%= @recipe.description%></p>
  <div class="d-flex gap bottom-line p-1">
    <%= button_to "Generate shopping list", new_food_path, method: :post, class: "btn" %>
    <%= button_to "Add ingredient", new_food_path, method: :post, class: "btn" %>
  </div>
</section>
<table class="table">
  <thead>
    <tr>
      <th class="input title">Food</th>
      <th class="input title">Quantity</th>
      <th class="input title">Value</th>
      <th class="input title">Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @foods.each do |food| %>
      <tr>
        <td class="input"><%= food.name %></td>
        <td class="input"><%= food.measurement_unit %></td>
        <td class="input"><%= food.price %></td>
        <td class="input">
          <%= link_to 'Delete', food_path(food), data: { turbo_method: :delete, confirm: 'Are you sure?' } %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const toggleSwitch = document.querySelector('.toggle-switch');
    const toggleForm = document.querySelector('.toggle-form');

    if (toggleSwitch && toggleForm) {
      toggleSwitch.addEventListener('change', function () {
        toggleForm.submit();
      });
    }
  });
</script>
